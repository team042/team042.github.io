<html>
<head>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
    <!-- sourcing add-ons for jquery-->
    <!-- <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script> -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster-src.js"></script>
    <script src="leaflet-ant-path.js"></script>
    <script src="leaflet.ajax.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
</head>
<body>
    <div id="map"></div>

    <script>
        var map = L.map('map').setView([17.410199787878017, 26.73338651585506], 4);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'}).addTo(map);
        map.options.minZoom = 3;
        var southWest = L.latLng(-89.98155760646617, -400),
        northEast = L.latLng(89.99346179538875, 400);
        var bounds = L.latLngBounds(southWest, northEast);
        map.setMaxBounds(bounds);
        
		function antPath(f, l){
			out = []
			if (f.geometry){
				for (key in f.properties) {
					if (f.properties["weight"]>=0.25) {
						if (key == "route_ID"){
							out.push("Route ID: " + f.properties[key]);
						}
						if (key == "orig_ISO"){
							out.push("Origin: " + f.properties[key]);
						}
						if (key == "dest_ISO"){
							out.push("Destination: " + f.properties[key]);
						}
						if (key == "route_type"){
							out.push("Route Type: " + f.properties[key]);
						}
						l.bindPopup(out.join("<br />"));
					}				
				}
			}
		}

		// pop-up function
        function popUp(f, l) {
            var out = [];
            if (f.properties) {
                for (key in f.properties) {
					if (key == "dyad_name"){
						out.push("Event Name: " + f.properties[key]);
					}
					if (key == "scale"){
						out.push("Scale: "+f.properties[key])
					}
					if (key == "date_start"){
						out.push("Event Start Date: "+f.properties[key])
					}
					if (key == "date_end"){
						out.push("Event End Date: "+f.properties[key])
					}
					l.bindPopup(out.join("<br />"));
				}
            }
        }

        // add layer to map and layer control
        function add_layer(layr, layr_name) {
            map.addLayer(layr);
            layerControl.addOverlay(layr, layr_name);
			layercontrol.addTo(map)
        }

        // fire ajax request
        var points = new L.GeoJSON.AJAX("events.geojson", { onEachFeature: popUp });

        // create empty marker cluster group
        var markers = L.markerClusterGroup()

        // when geojson is loaded, add points to marker cluster group and add to map & layer control
        points.on('data:loaded', function () {
            markers.addLayer(points);
            add_layer(markers, "Point Markers")
        });

		// Create layer group for ant paths
		var antPaths = L.layerGroup()
		// when geojson is loaded, add paths to group and add to map & layer control
		var paths = new L.GeoJSON.AJAX("sc_routes.geojson", { onEachFeature: popUp});
        paths.on('data:loaded', function () {
			antPaths.addLayer(paths);
			add_layer(antPaths, "Routes")
        });
		// antPaths.addTo(map)
		// layerControl.addTo(map);
    </script>
</body>
</html>